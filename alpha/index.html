<!DOCTYPE html>
<html>
  <head>
    <title>Testing - EJS</title>
    <meta charset="UTF-8">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.css"  media="screen,projection"/>
    <link rel="stylesheet" href="css/animate.css">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="js/ejs.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/marked.min.js"></script>
    <script src="js/xss.min.js"></script>
    <script src="js/func.js"></script>

  </head>

  <body>
        <div class="row container">
            <div class="col s12 m8 l9"><main></main></div>
            <div class="col s12 m4 l3">
                
        </div>

    <script>
        //let data = JSON.parse('{"nick": "labrusca", "name": "Light of Seraphim"}')
        $.get("feed.json", (data,status) => {
            //let html = new EJS({url: 'views/footer.ejs'}).render(date);
            let n=0;
            $(".container").before(loadEjs('views/navbar.ejs', data))
            $("body").append(loadEjs('views/footer.ejs', data))
            $("main").animateCss('fadeIn');
            for(;n<4;n++) {
                $("main").append(loadEjs('views/list.ejs', data.items[n]))
            }
            $(window).scroll(() => {
                var scrollTop = $(this).scrollTop()
                var scrollHeight = $(document).height()
                var windowHeight = $(this).height()
                if (scrollTop + windowHeight >= scrollHeight) {
                    //console.log()
                    data.items.slice(n,n+4).forEach(item => {
                        $("main").append(loadEjs('views/list.ejs', item))
                        $(`#${btoa(item.id)}`).animateCss('fadeIn');
                    })
                    n += 5;
                }
            })
        })
    </script>
    <script>
        $(document).ready(function(){
            M.AutoInit();
            $(".button-collapse").sideNav();
        });  
    </script>
    <!--JavaScript at end of body for optimized loading-->
    <script type="text/javascript" src="js/materialize.js"></script>
  </body>
</html>
[TITLE]:利用遗留的旧版API/页面绕过账号实名认证
[TAGS]:技术

> 许多网站在更新改版之后由于各种各样的原因仍然保留了旧版网站的一些可访问的API或者页面，于是漏洞就此开始产生了。

最近买了一块手表，由于是在香港买的，所以我想验证下产品的真伪，于是GOOGLE怎么验证产品的真伪，网友的留言给了一个手表网站的的会员注册地址，并说验证产品要先注册成会员绑定产品去验证真伪。小心翼翼的我并没有直接点开注册地址，而是又去搜索我买的那个手表品牌的官方网站，再点击会员注册。  
咦？怎么两个会员注册地址不一样呢？难道网友给的是钓鱼网站？不对呀，虽然是不同的二级域名，不同的网页版式，但两个网址的主域名都是一样的，HTTPS证书也一致的嘛。怎么回事呢？原来网友提供的网址是旧版的地址，而官方网站早已经改版成新的了，会员注册网址也变成新的，但却没有删掉旧版的注册页面。  
本来我对这件事也没上心，直接用新版的注册页面进行注册就好了，可是新版的注册页面需要实名认证，因为国家有这个规定嘛，实名认证也很正常，但我偏偏最讨厌实名认证了，能不能不实名认证而成功注册呢？我就想到了刚才看到的旧版注册页面，没有要求要实名认证呢，如果旧版的页面还能注册成功的话……

我的天！真的可以！他们改版时不仅旧版注册页面没删掉，而且旧版API能正常使用！  
好吧我承认有点大惊小怪了，其实这种情况我也遇见了不少，仅仅在工作中就遇到不止一个客户的WEB网站/系统在改版时没有将原来的东西清除干净而被我在WEB安全测试中发现。

这种情况就属于OWASP TOP 10 2017中的A5——失效的访问控制。

### 失效的访问控制
我常常用一个房子来比作一个业务系统，房门、锁、摄像头等等是它的安全措施。刚才说到的旧API/页面的问题，就相当于你把房子重新装修了一下，并另外在一个地方开了一扇门，但原来的那扇门你却没有封死一样，别人仍然可以通过原来的门访问你家。这就是失效的访问控制。  
不仅仅是改版，我的另一个客户在按照我的安全整改建议书中的一处API进行修补时，为了符合我的“增加防暴力破解防护”的条目，直接重写了这个API，新的API倒是通过了我的安全测试，但旧的API却没有删除，这跟以前的安全风险又一样了，由于新的API的出现安全风险还可能变得更高。

这里仅仅以WEB系统为例，其实所有系统都一样，只要涉及不向下兼容的系统改动，一定要在系统改动完成后完全删除却不兼容的一切内容，且不要将旧版的备份系统直接放在生产环境中，避免产生其实更严重的安全问题。所以在日常的系统维护中，一定要做到在系统的不兼容更新改动生效前完成所有的旧版到新版的数据兼容移植，并且在更改动生效、上线生产环境中后及时删除所有不兼容的旧版内容以保证系统的安全。